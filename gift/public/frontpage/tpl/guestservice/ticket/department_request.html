<script type="text/ng-template" id="locationTypeahead.html">
     <a>
          <span ng-bind="match.model.name"></span><br>
          <span style="font-size: 10px" ng-bind="match.model.type"></span><br>
     </a>
</script>
<script type="text/ng-template" id="userTypeahead.html">
     <a>
          <span ng-bind="match.model.wholename"></span><br>
          <span style="font-size: 10px" ng-bind="match.model.job_role"></span><br>
          <span style="font-size: 10px" ng-bind="match.model.department"></span><br>
     </a>
</script>

<div class="col-centered wrapper-sm" style="{{full_height}}">
	<div class="col-centered">
		<div class="panel panel-default">
			<div class="panel-heading">
				<label class="font-bold"><i class="fa fa-bank" aria-hidden="true"></i>&nbsp;&nbsp;Create Department Request</label>
				<div class="pull-right">
		      <div class="btn-group" uib-dropdown is-open="status.isopen">
		        <button type="button" class="btn btn-dark btn-sm" ng-click="createTasks(0)">
		        	<span class="font-bold text-success">Create</span>
		        </button>
		        <button type="button" class="btn btn-dark btn-sm" uib-dropdown-toggle>
		          <span class="text-success caret"></span>
		        </button>
		        <ul class="dropdown-menu" role="menu" style="margin-left:-130px">
		          <li ng-click="createTasks(1)"><a href>Create & add for same room</a></li>
		          <li ng-click="createTasks(2)"><a href>Create & add for different room</a></li>
		        </ul>
		      </div>
		      <button type="button" class="btn btn-dark btn-sm" ng-click="removeNewSelectTicket(tab)">
		      	<span class="font-bold text-danger">Cancel<span>
		      </button>
		    </div>
			</div>
			<div class="panel-body">
				<form class="form-horizontal">
					<div class="form-group label-group">
						<div class="col-sm-2 control-label text-muted">Request ID</div>
						<div class="col-sm-4 control-label font-bold" style="text-align: left">
							{{ticket_id}}
						</div>
						<div class="col-sm-2 control-label text-muted">Request Time</div>
						<div class="col-sm-4 control-label font-bold" style="text-align: left">
							{{location.request_time}}
						</div>
					</div>
					<div class="form-group label-group">
						<div class="col-sm-2 control-label text-muted">Location</div>
						<div class="col-sm-4 control-label" style="text-align: left">
							<div class="scrollable-dropdown-menu">
				                <input type="text" ng-model="location.name" class="form-control input-sm" placeholder="Enter location name"
				                  uib-popover="Enter location name" popover-trigger="mouseenter"
				                  uib-typeahead="room.room for room in location_list | filter:$viewValue | limitTo:10"
				                  typeahead-editable="false"
				                  typeahead-min-length="0"
				                  typeahead-template-url="locationTypeahead.html"
				                  typeahead-on-select="onLocationSelect($item, $model, $label)" required>
				            </div>
						</div>
						<div class="col-sm-2 control-label text-muted">Location Type</div>
						<div class="col-sm-4 control-label font-bold" style="text-align: left">
							{{location.type}}
						</div>
					</div>
					<div class="col-sm-12 label-group" ng-hide="true">
						<div class="col-sm-2 control-label text-muted">Requestor</div>
						<div class="col-sm-4 control-label" style="text-align: left">
							<div class="scrollable-dropdown-menu">
								<input type="text" ng-model="location.requester.wholename" class="form-control input-sm"
									placeholder="Enter requestor's name"
					                uib-typeahead="user.username for user in staff_list | filter:$viewValue | limitTo:10"
				                  	typeahead-editable="false"
					                typeahead-on-select="onRequesterSelect($item, $model, $label)"
					                typeahead-min-length="0" typeahead-template-url="userTypeahead.html" required>
				                </div>
						</div>
						<div class="col-sm-2 control-label text-muted">Job Role</div>
						<div class="col-sm-4 control-label font-bold" style="text-align: left">
							{{location.requester.job_role}}
						</div>
					</div>
					<!--
					<div class="col-sm-1">
	        	<label class="control-label" style="font-size:8px"> Notify </label><br>
	        	<label class="i-checks m-b-none">
	        		<input type="checkbox" ng-model="location.notify_flag"><i></i>
	        	</label>
	      	</div>
          <div class="col-sm-2">
            <label class="control-label" style="font-size:8px;" ng-disabled="!location.notify_flag"> Time </label>
            <input type="text" class="form-control input-sm" ng-model="location.request_time"
            	ng-disabled="!location.notify_flag" required>
          </div>
          <div class="col-sm-4">
            <label class="control-label" style="font-size:8px;" ng-disabled="!location.notify_flag"> Mobile </label>
            <input type="text" class="form-control input-sm" ng-model="location.requester.mobile"
            	ng-disabled="!location.notify_flag" required>
          </div>
          <div class="col-sm-5 form-group">
            <label class="control-label" style="font-size:8px;" ng-disabled="location.notify_flag"> E-mail </label>
            <input type="text" class="form-control input-sm" ng-model="location.requester.email"
            ng-disabled="!location.notify_flag" required>
          </div>
					-->
          	<div class="line line-dashed b-b wrapper-xs" ng-show="location.id > 0 && location.requester && location.requester.wholename.length > 0"></div>
	      	<div class="wrapper" ng-show="location.id > 0 && location.requester && location.requester.wholename.length > 0">
		        <div ng-repeat="item in system_task_list" class="col-lg-2-4 btn-group btn-group-justified m-t-xs m-b-xs"
			        style="display: table; padding-left: 2px; padding-right: 2px" ng-dblclick="addSystemTask(item)" sgldclick="addSystemTaskq(item)">
		          	<div class="btn w-ms btn-primary text-center text-xs font-bold">
		          		<a>
		          			<span class="text-warning" ng-init="limit = 20; moreShown = false" title="{{item.task}}">
				          		{{item.task | limitTo: limit}}{{item.task.length > limit ? '..' : ''}}
				          	</span>
									</a>
			        </div>
		        </div>
	      	</div>
          
          <div class="line line-dashed b-b wrapper-xs line-md" 
	          ng-show="location.id > 0 && location.requester && location.requester.wholename.length > 0">
		  </div>
			<div ng-show="location.id > 0 && location.requester && location.requester.wholename.length > 0">
						<div ng-repeat="item in quicktasks" class="col-lg-2-4 btn-group btn-group-justified m-t-xs m-b-xs"
			        style="display: table; padding-left: 2px; padding-right: 2px" ng-dblclick="addQuickTask(item)" sgldclick="addQuickTaskq(item)">
		          <div class="btn w-ms btn-dark text-center text-xs font-bold"><a>
			          <a>
		          		<span class="text-warning" ng-init="limit = 20; moreShown = false" title="{{item.task}}">
				          	{{item.task | limitTo: limit}}{{item.task.length > limit ? '..' : ''}}
				          </span>
								</a>
			        </div>
		        </div>
		    </div>
				</form>
			</div>
		</div>
	</div>
	
	<div class="col-centered" ng-show="location.id > 0 && location.requester && location.requester.wholename.length > 0">
		<div class="panel panel-default">
			<div class="panel-heading">
				<label class="font-bold"><i class="fa fa-pencil-square-o" aria-hidden="true"></i>&nbsp;&nbsp;Add Task</label>
				<i class="fa fa-plus-circle fa-2x text-success ng-click-active pull-right" style="cursor: pointer" title="Add New Task"
			          	ng-click="addTask(true)"></i>
			</div>
			<div class="panel-body">
				<form class="form-horizontal">
					<div class="label-group">
						<div class="col-sm-2 control-label text-muted">Add Task</div>
						<div class="col-sm-4 control-label" style="text-align: left">
							<div class="scrollable-dropdown-menu">
				              <input ng-model="main_task.tasklist.task" class="form-control input-sm"
				                uib-typeahead="item.task for item in getTaskList($viewValue)"
				                typeahead-on-select="onMainTaskSelect(main_task, $item, $model, $label)"
				                typeahead-min-length="0"
				                typeahead-no-results="noResults" required />
				              <span ng-if="noResults" uib-dropdown uib-dropdown-toggle auto-close="disabled" is-open="true">
				                <ul class="dropdown-menu" >
				                  <li><a href ng-click="onAddTask()">{{main_task.tasklist.task}} (New Task Item)</a></li>
				                </ul>
				              </span>       
				            </div>
						</div>
						<div class="col-sm-2 control-label text-muted">Quantity</div>
						<div class="col-sm-4 control-label" style="text-align: left">
							<input type="number" class="form-control input-sm" ng-model="main_task.quantity" min="1" maxlength="2" style="width: 50px">
						</div>
					</div>
					<div class="label-group">
						<div class="col-sm-2 control-label text-muted">Department</div>
						<div class="col-sm-4 control-label" style="text-align: left">
							<div class="scrollable-dropdown-menu">
				                <input ng-model="main_task.department" maxlength="50" class="form-control input-sm"
						              uib-typeahead="item.department for item in dept_list | filter:$viewValue | limitTo:10"
						              typeahead-on-select="onMainDepartSelect(main_task, $item, $model, $label)"
						              typeahead-editable="false"
						              typeahead-min-length="0"
						              ng-disabled="!main_task.department_edit_flag" required/>
				            </div>
						</div>
						<div class="col-sm-2 control-label text-muted">Function</div>
						<div class="col-sm-4 control-label font-bold" style="text-align: left">
							<input class="form-control input-sm" 
								ng-model="main_task.dept_func.function" 								
								uib-typeahead="item.function for item in getDeptFuncList($viewValue, main_task.department_id)"
				                typeahead-on-select="onMainDeptFuncSelect(main_task, $item, $model, $label)"
				                typeahead-editable="false"
				                typeahead-min-length="0"
								ng-disabled="!main_task.department_edit_flag" required>
						</div>
					</div>
					<div class="label-group">
						<div class="col-sm-2 control-label text-muted">Staff</div>
						<div class="col-sm-4 control-label" style="text-align: left">
							<div class="scrollable-dropdown-menu">
								<input type="text" ng-model="main_task.username" class="form-control  input-sm"
				                  	uib-typeahead="item.wholename for item in main_task.userlist | filter:{wholename:$viewValue} | limitTo:10"
						            typeahead-min-length="0"
						            typeahead-editable="false"
				                  	typeahead-on-select="onStaffSelect(main_task, $item, $model, $label)" required>
							</div>
						</div>
						<div class="col-sm-2 control-label text-muted">Device</div>
						<div class="col-sm-4 control-label font-bold" style="text-align: left">
							<input class="form-control input-sm" ng-model="main_task.device" disabled required>
						</div>
					</div>
					<div class="label-group">
						<div class="col-sm-2 control-label text-muted">Priority</div>
						<div class="col-sm-4 control-label" style="text-align: left">
	             			<select class='form-control input-sm' ng-model="main_task.priority_id" 
	                        		ng-options="value.id as value.priority for (key, value) in prioritylist" />	
            			</div>
            			<div class="col-sm-2 control-label text-muted">Duration</div>
						<div class="col-sm-4 control-label" style="text-align: left">
							<input type="number" class="form-control input-sm" ng-model="main_task.max_duration" maxlength="2" style="width: 60px">
						</div>
					</div>
					<div class="label-group">
			            <div class="col-sm-2 control-label text-muted">Comment</div>
			            <div class="col-sm-10 control-label" style="text-align: left">
			              <textarea class="form-control input-sm" rows="1" ng-model="main_task.custom_message" style="resize:none"></textarea>
			            </div>
			        </div>
					<div class="label-group">
			          	<div class="col-sm-2 control-label text-muted">Schedule</div>
			          	<div class="col-sm-2 control-label" style="text-align: left">
				            <label class="i-switch m-t-xs m-r" style="margin-top: -2px">
				              <input type="checkbox" ng-model="main_task.schedule_flag" checked>
				            	<i></i>
				            </label>
			          	</div>
				        <div class="col-sm-4 form-group">
				            <div class="dropdown">
				              <a class="dropdown-toggle" id="dropdown2" role="button" data-toggle="dropdown" data-target="#">
				                <div class="input-group">
				                  <input type="text" class="form-control" ng-disabled="!main_task.schedule_flag" ng-model="main_task.date">
				                  <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
				                </div>
				              </a>
				              <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel" ng-show="main_task.schedule_flag">
				                <datetimepicker ng-model="datetime.date" data-datetimepicker-config="{ dropdownSelector: '#dropdown2' }"
				                  data-before-render="beforeRender($view, $dates, $leftDate, $upDate, $rightDate)"/>
				              </ul>
				            </div>
            			</div>
	        		</div>
       			</form>
			</div>
		</div>
	</div>
	
	<div class="col-centered" ng-show="location.id > 0 && location.requester && location.requester.wholename.length > 0">
		<div class="panel panel-default">
			<div class="panel-heading">
				<label class="font-bold"><i class="fa fa-plus-square" aria-hidden="true"></i>&nbsp;&nbsp;Add More Task</label>
			</div>
			<div class="panel-body">				
				<form class="form-horizontal form-validation wrapper">
				    <div class="form-group label-group" style="width:98%; margin:auto" ng-repeat="task in tasks">
				    	<div class="form-group col-md-10">
				    		<div class="col-md-4 ">
				    		  	<span class="pull-left" style="margin-left: 3px" >{{task.tasklist.task}}</span>
				    		</div>
				    		<div class="col-md-4">
				    		  	<span class="pull-left" style="margin-left: 3px" >{{task.department}}</span>
				    		</div>
				    		<div class="col-md-4" ng-show="!main_task.schedule_flag">
				    		  	<span class="pull-left"  style="margin-left: 3px" >{{task.username}}</span>
				    		</div>
				    	</div>
				    	<div class="form-group col w-xs col-md-1">
				    	  	<span class="pull-right" style="margin-right: 20px">{{task.quantity}}</span>
				    	</div>
				    	<div class="form-group col w-xs col-md-1">
				    	  	<span class="glyphicon icon-close pull-right" style="margin-top:3px;margin-right: 10px; color: red" ng-click="removeTask()"></span>
				    	</div>
			    	</div>
				</form>
			</div>
		</div>
	</div>
</div>


